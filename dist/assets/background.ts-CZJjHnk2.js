import{A as d}from"./constants-D_3DnnfB.js";function m(r,o){try{const t=new URL(r),e=new URL(o);return t.hostname===e.hostname}catch(t){return console.error("Error validating URL:",t),!1}}const l=async()=>{const[r]=await chrome.tabs.query({active:!0,currentWindow:!0,lastFocusedWindow:!0});return r},p=(r,o)=>r.replace("{prompt}",encodeURIComponent(o)),u=async({prompt:r,inputSelector:o})=>{const t=await l();return console.log("activeTab",t),chrome.tabs.sendMessage(t.id,{action:"insertPrompt",data:{prompt:r,inputSelector:o}})},f=async r=>new Promise(o=>{chrome.tabs.onUpdated.addListener((t,e,n)=>{e.status==="complete"&&t===r&&o(n)})});async function U(r){if(!r.data)return!1;const{modelId:o,prompt:t}=r.data,e=d.find(n=>n.id===o);if(!e)return!1;try{const n=await l();if(!(n!=null&&n.id))return!1;if((n==null?void 0:n.url)&&m(n.url,e.baseUrl)){const s=await u({prompt:t,inputSelector:e.inputSelector});if(s!=null&&s.success)return!0}if(e.promptUrl){const s=p(e.promptUrl,t);return await chrome.tabs.create({url:s}).then(i=>!!(i!=null&&i.id))}const a=await chrome.tabs.create({url:e.baseUrl});if(!(a!=null&&a.id))return!1;await f(a.id);const c=await u({prompt:t,inputSelector:e.inputSelector});return c==null?void 0:c.success}catch(n){return console.error("Error in handleUsePrompt:",n),!1}}chrome.runtime.onMessage.addListener((r,o,t)=>{if(r.action==="usePrompt")return U(r).then(e=>t({success:e})),!0});
